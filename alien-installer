#!/bin/bash 
#############################################################################
# alien-installer - a front-end script to install and configure AliEn
#############################################################################
#
# modification history
# $Log$
# Revision 1.120  2008/11/13 09:52:08  buncic
# Commiting last set fo updates
#
# Revision 1.118  2008/05/26 12:22:52  buncic
# Using curl instead of wget
#
# Revision 1.117  2008/05/16 10:12:28  buncic
# Removing legacy installation procedure
#
# Revision 1.116  2008/02/22 11:15:50  buncic
# Updating platform for Leopard
#
# Revision 1.115  2008/02/18 10:31:15  buncic
# Adding '=' at the end of MASKED package names
#
# Revision 1.114  2007/11/07 14:29:56  buncic
# Using package dependencies generated by BITS
#
# Revision 1.113  2007/11/01 11:13:19  buncic
# Speeding up downloads, update should work now.
#
# Revision 1.112  2007/09/05 10:47:16  buncic
# Adding meta package for AliEn Bank, update of amon to use jabber transport
#
# Revision 1.111  2007/08/16 14:20:24  catalin
# if on a 64bit platform, also add ALIEN_ROOT/lib64 to the ALIEN_LD_LIBRARY_PATH
#
# Revision 1.110  2007/03/09 17:09:54  buncic
# Preparing new release
#
# Revision 1.107  2006/10/26 09:06:27  buncic
# Adding option to install PANDA CA
#
# Revision 1.106  2006/09/11 14:12:48  buncic
# Removing obsolete environemnt variables
#
# Revision 1.105  2006/08/08 11:08:56  buncic
# Adding sanity check and ALIEN_VERSION
#
# Revision 1.104  2006/07/13 22:45:36  buncic
# Latess diffs for v2-11
#
# Revision 1.103  2006/06/15 08:49:59  buncic
# Fixed return value in InstallerMakePkg()
#
# Revision 1.102  2006/06/13 10:00:17  buncic
# Fix to update Environment file in interactive session
#
# Revision 1.101  2006/05/30 10:13:55  buncic
# Unset LD_LIBRARY_PATH before wget
#
# Revision 1.100  2006/04/24 09:23:09  buncic
# Fixed bug in guessing the platform
#
# Revision 1.99  2006/04/19 07:13:59  buncic
# Fixing platform
#
# Revision 1.98  2006/04/18 17:03:17  buncic
# Updating version number
#
# Revision 1.97  2006/04/06 14:27:48  buncic
# Adding Mac Intel platform
#
# Revision 1.96  2006/03/07 09:48:58  buncic
# Adding /usr/lib/rpm to possible locations of config.guess
#
# Revision 1.95  2006/03/02 10:15:11  buncic
# Disabling autodetect for gcc
#
# Revision 1.94  2006/03/02 10:10:29  buncic
# Autodetect for gcc does not work - leave it as it is for now.
#
# Revision 1.93  2006/03/01 17:37:42  buncic
# Again AUTODETECT
#
# Revision 1.92  2006/02/23 13:58:17  buncic
# Trying to fix autodetect
#
# Revision 1.91  2006/02/22 09:42:28  buncic
# Fixed typo in autodetect, gar.mk
#
# Revision 1.90  2006/02/20 16:17:05  buncic
# Adding 'tests' package.
#
# Revision 1.89  2006/02/17 15:04:51  buncic
# Fix for setup on MAcOS
#
# Revision 1.88  2006/02/16 09:45:02  buncic
# PRint message if dialog cannot be found...
#
# Revision 1.87  2006/02/09 11:22:19  buncic
# Reverting to --inputbox in place of --fselect widget
#
# Revision 1.86  2006/02/08 11:25:35  buncic
# Update to installer. Added dialog dependency to gshell. New version for common.
#
# Revision 1.85  2006/02/06 16:02:41  buncic
# Fix from Jan Fiete
#
# Revision 1.84  2006/02/02 17:08:20  buncic
# Fixing amd platform issues
#
# Revision 1.83  2006/01/31 20:45:13  buncic
# Fix to installer, removing psh
#
# Revision 1.82  2006/01/30 21:36:12  buncic
# platform fix from Jan-Fiete
#
# Revision 1.81  2006/01/24 13:39:58  buncic
# Fix to installer and update to gar.lib.mk (avoid building from CVS if there
# was no update).
#
# Revision 1.80  2006/01/20 13:10:32  buncic
# Fixing bug in the installer.
#
# Revision 1.79  2005/12/21 15:54:41  buncic
# Typo
#
# Revision 1.78  2005/12/21 09:05:14  buncic
# Do not use rsync and CVS to synchronize makefiles, added xrootd meta package
#
# Revision 1.77  2005/11/04 11:06:34  buncic
# Configure common and not user Environemnt
#
# Revision 1.76  2005/11/03 21:38:47  buncic
# Print "done" at the end of install, update date of v2-4 release
#
# Revision 1.75  2005/10/29 12:22:07  buncic
# Fix for gcc
#
# Revision 1.74  2005/10/26 13:50:42  buncic
# Typo in autodetect...
#
# Revision 1.73  2005/10/26 12:43:00  buncic
# Removing dependency on dialog
#
# Revision 1.72  2005/10/26 12:13:43  buncic
# Splitting installation and setup phase
#
# Revision 1.71  2005/10/26 12:09:04  buncic
# Moving post -install scripts to relocate.sh
#
# Revision 1.70  2005/10/26 11:49:53  buncic
# Adding root meta package to installer, update API to new version from Andreas
#
# Revision 1.69  2005/10/09 20:02:46  buncic
# Fix to installer, do not install gcc if suitable version is already found on
# the system.
#
# Revision 1.68  2005/10/05 12:03:53  buncic
# Adding x86_64-unknown-linux-gnu as supported platform
#
# Revision 1.67  2005/09/07 09:50:42  buncic
# Added lcg meta package.
#
# Revision 1.66  2005/09/07 09:36:00  buncic
# Fixing update
#
# Revision 1.65  2005/09/05 13:30:35  buncic
# installer setup will configure common and not user Environment
#
# Revision 1.64  2005/08/29 13:25:22  buncic
# Use CVS only if rsync fails
#
# Revision 1.63  2005/08/02 15:26:17  buncic
# USe + insted of " " to separate compinents in ALIEN_INSTALLER_TYPE
#
# Revision 1.62  2005/08/02 13:53:17  buncic
# Allow installer updates to new version (-r vN-M)
#
# Revision 1.61  2005/07/18 10:51:45  buncic
# Streamlining alien-installer, removing a few questions...
#
# Revision 1.60  2005/07/07 07:39:36  buncic
# Fixed download URL (/download and not /dist)
#
# Revision 1.59  2005/07/06 21:00:15  buncic
# Changed release label in installer
#
# Revision 1.58  2005/07/04 21:20:21  buncic
# Using binary distribution from the build servers.
#
# Revision 1.57  2005/06/27 15:05:52  buncic
# Clean cookies before full install.
#
# Revision 1.56  2005/06/27 13:38:59  buncic
# Adding patches for Tiger (fca).
#
# Revision 1.55  2005/06/27 13:06:33  buncic
# Use common platform.sh script where possible.
#
# Revision 1.54  2005/06/21 09:20:53  buncic
# Do not clear the screen if --trace option is specified
#
# Revision 1.53  2005/06/03 09:16:50  buncic
# Finally fixing update...
#
# Revision 1.51  2005/06/03 08:47:50  buncic
# ditto...
#
# Revision 1.50  2005/06/03 08:42:52  buncic
# typo
#
# Revision 1.49  2005/06/03 08:34:45  buncic
# Fixing multiple met package list.
#
# Revision 1.48  2005/06/03 08:21:47  buncic
# Added --force option for update.
#
# Revision 1.47  2005/06/02 12:16:28  buncic
# Do not clean target directory.
#
# Revision 1.46  2005/06/02 10:57:23  buncic
# Adding root to gshell meta package.
#
# Revision 1.45  2005/06/02 08:22:43  buncic
# Typo.
#
# Revision 1.44  2005/06/02 08:09:20  buncic
# No default meta package selected.
#
# Revision 1.43  2005/06/02 07:54:52  buncic
# Adding gshell and monitor meta packages
#
# Revision 1.42  2005/06/02 07:29:40  buncic
# Preparing for v2-0-5 release.
#
# Revision 1.41  2005/05/19 07:58:43  buncic
# Using separate binary repository for each release.
#
# Revision 1.40  2005/05/17 10:55:00  buncic
# Skip installation log dump if there was no error.
#
# Revision 1.39  2005/05/17 10:22:00  buncic
# Adding --force flag.
#
# Revision 1.38  2005/05/17 04:49:22  buncic
# PReserve output in case of error.
#
# Revision 1.37  2005/05/11 04:20:18  buncic
# Added warning message if user selects prefix directory same as workspace.
#
# Revision 1.36  2005/05/10 10:49:48  buncic
# This is v2.0.4 rc1.
#
# Revision 1.35  2005/04/27 08:11:13  buncic
# Added autopackage tools and apkg as alternative installer.
#
# Revision 1.34  2005/04/25 10:54:22  buncic
# Fixed configuration step.
#
# Revision 1.33  2005/04/01 11:47:40  buncic
# Cleanup..
#
# Revision 1.32  2005/04/01 10:35:45  buncic
# Fix to alien-installer
#
# Revision 1.31  2005/03/31 07:50:11  buncic
# Always update from CVS.
#
# Revision 1.30  2005/03/15 07:37:01  buncic
# Tests added to CVS.
#
# Revision 1.29  2005/03/14 13:37:19  buncic
# Grrr..
#
# Revision 1.28  2005/03/14 13:21:03  buncic
# Added options to configure installer w/o dialog (from command line)
#
# Revision 1.27  2005/03/14 10:58:42  buncic
# Typo.,..
#
# Revision 1.26  2005/03/14 10:08:56  buncic
# Avoid using backticks.
#
# Revision 1.25  2005/03/14 09:52:39  buncic
# Fixed problem with dialog running under su.
#
# Revision 1.24  2005/03/11 12:47:49  buncic
# Fixed release version problem.
#
# Revision 1.23  2005/03/11 11:14:35  buncic
# Changed format of release tag.
#
# Revision 1.22  2005/03/11 09:37:44  buncic
# Fixed problem with double sync
#
# Revision 1.21  2005/03/10 05:11:24  buncic
# Again
#
# Revision 1.20  2005/03/08 14:16:50  buncic
# Always use dialog from /opt/alien if it exists.
#
# Revision 1.19  2005/03/08 14:12:46  buncic
# Require dialog > 1.0 to process forms.
#
# Revision 1.18  2005/03/08 14:09:43  buncic
# Typo
#
# Revision 1.17  2005/03/08 13:52:50  buncic
# Check that alien-installer exists upin cvs checkout.
#
# Revision 1.16  2005/03/02 12:18:07  buncic
# Fixed CVS update problem
#
# Revision 1.15  2005/03/02 11:58:24  buncic
# Fixed rsync update.
#
# Revision 1.14  2005/03/02 11:50:37  buncic
# Popup error box if synchronisation fails.
#
# Revision 1.13  2005/03/02 11:41:04  buncic
# Added option to install specific AliEn release.
#
# Revision 1.12  2005/03/01 13:53:34  buncic
# Be quite.
#
# Revision 1.11  2005/03/01 13:46:50  buncic
# Redefine TPUT when redirecting output to file.
#
# Revision 1.10  2005/03/01 13:28:13  buncic
# Fixed cvs checkout.
#
# Revision 1.9  2005/03/01 12:12:50  buncic
# Add -d option to cvs update.
#
# Revision 1.8  2005/03/01 12:07:00  buncic
# Ditto.
#
# Revision 1.7  2005/03/01 12:02:57  buncic
# Fixed typo.
#
# Revision 1.6  2005/03/01 11:56:47  buncic
# Create anonymous cvs login if it does not exist.
#
# Revision 1.5  2005/03/01 05:52:10  buncic
# Fixed platform names.
#
# Revision 1.4  2005/03/01 04:47:02  buncic
# Checksums for i386 binary packages.
#
#
# SYNOPSIS
#
# DESCRIPTION
#
# AUTHOR:
# Predrag Buncic, e-mail: Predrag.Buncic@cern.ch
#
# CREATION DATE:
#C<
#############################################################################
VERSION=0.15
###########################################################################
style="--title AliEn-Installer-v$VERSION --clear"
height=8; width=60
which wget > /dev/null 2>&1 &&  wget="env LD_LIBRARY_PATH= DYLD_LIBRARY_PATH= wget -O" 
which curl > /dev/null 2>&1 && wget="env LD_LIBRARY_PATH= DYLD_LIBRARY_PATH= curl -f -L -o" 
[ "x$wget" = x ] &&  Error "Please install wget or curl before running the installer"
###########################################################################
Exit()
###########################################################################
{
  InstallerRcUpdate
  rm -rf $release_file $dialog_file $cache_file
  if [ ! -z "$2" ]
  then
     echo $2
  fi
  exit $1
}

###########################################################################
Error()
###########################################################################
{
   which dialog > /dev/null 2>&1
   if [ $? -ne 0 ] 
   then
     echo "Error: dialog not found." $1
     echo "Error:" $1
   else
     dialog $style --msgbox "$1" $height $width
   fi
   exit 1
}
###########################################################################
[ -f $HOME/.alien/installer.rc ] && . $HOME/.alien/installer.rc
###########################################################################
ALIEN_INSTALLER_HOME=${ALIEN_INSTALLER_HOME:=$HOME/.alien/cache}
ALIEN_INSTALLER_PREFIX=${ALIEN_INSTALLER_PREFIX:=/opt/alien}
ALIEN_INSTALLER_AUTODETECT=${ALIEN_INSTALLER_AUTODETECT:=false}
ALIEN_INSTALLER_TYPE=${ALIEN_INSTALLER_TYPE:=all}
ALIEN_INSTALLER_PLATFORM=${ALIEN_INSTALLER_PLATFORM:=}
unset TMPDIR
if [ "x$ALIEN_INSTALLER_PLATFORM" = "x" ]
then
  for guess in /usr/share/libtool/config.guess  /usr/share/libtool/config/config.guess /usr/share/automake/config.guess /usr/lib/rpm/config.guess `locate config.guess 2> /dev/null`
  do
    if [ -f $guess ]  
    then 
       ALIEN_INSTALLER_PLATFORM=`$guess`
       break
    fi 
  done
  case $ALIEN_INSTALLER_PLATFORM in
     i*86-*-linux-gnu)
       ALIEN_INSTALLER_PLATFORM=i686-pc-linux-gnu
       ;; 
     ia64-*-linux-gnu) 
       ALIEN_INSTALLER_PLATFORM=ia64-unknown-linux-gnu 
       ;;
     powerpc-apple-darwin8.*.*) 
       ALIEN_INSTALLER_PLATFORM=powerpc-apple-darwin8.1.0 
       ;;
     i686-apple-darwin8.*|i686-apple-darwin9.*)
        case `sysctl machdep.cpu.extfeatures` in
          *EM64T)
            ALIEN_INSTALLER_PLATFORM=x86_64-apple-darwin8.6.1
          ;;
          *)    
            ALIEN_INSTALLER_PLATFORM=i686-apple-darwin8.6.1
          ;;
         esac
       ;;
      x86_64-*-linux-gnu)
       ALIEN_INSTALLER_PLATFORM=x86_64-unknown-linux-gnu
       ;;
      *)
       ;;
  esac
fi

if [ "x$ALIEN_INSTALLER_PLATFORM" = "x" ]
then
  Error "Could not guess your platform. Please set ALIEN_INSTALLER_PLATFORM variable"
fi

ALIEN_DIALOG=${ALIEN_DIALOG:=dialog}
ALIEN_RELEASE=${ALIEN_RELEASE:=HEAD}
ALIEN_INSTALLER_TYPE=$(echo $ALIEN_INSTALLER_TYPE | sed 's/+/ /g')
ECHO=""
###########################################################################
InstallerRcUpdate()
###########################################################################
{
  mkdir -p $HOME/.alien
  (
    ALIEN_INSTALLER_TYPE=$(echo $ALIEN_INSTALLER_TYPE | sed 's/ /+/g')
    echo "ALIEN_INSTALLER_HOME=$ALIEN_INSTALLER_HOME" 
    echo "ALIEN_INSTALLER_PREFIX=$ALIEN_INSTALLER_PREFIX" 
    echo "ALIEN_INSTALLER_AUTODETECT=$ALIEN_INSTALLER_AUTODETECT" 
    echo "ALIEN_INSTALLER_TYPE=$ALIEN_INSTALLER_TYPE" 
    echo "ALIEN_INSTALLER_PLATFORM=$ALIEN_INSTALLER_PLATFORM" 
    echo "ALIEN_DIALOG=$ALIEN_DIALOG" 
    echo "ALIEN_RELEASE=$ALIEN_RELEASE" 
    echo "ALIEN_BITS_URL=$ALIEN_BITS_URL" 
  ) > $HOME/.alien/installer.rc

}
###########################################################################
InstallerMake()
###########################################################################
{
  cmd=$1; shift 1
  if [ $# -eq 0 ]
  then
    $ECHO make -C $ALIEN_INSTALLER_HOME/meta/alien $cmd || Exit 1
  else
    list=$*
    for pkg in $list
    do
      dirs=`find $ALIEN_INSTALLER_HOME/apps -type d -mindepth 2 -maxdepth 2 -type d -path "$pkg"`
      for dir in $dirs 
      do
        if [ ! -d $dir ]
        then
          Error "No such package: $dir"
        fi
        $ECHO make -C $dir $cmd >> install.log 2>&1 || Exit 1
      done
    done
  fi
}

###########################################################################
InstallerMakePkg()
###########################################################################
{
  cmd=$1; shift 1
  list=$*
  for dir in $list
  do
    if [ ! -d $dir ]
    then
      Error "No such package: $dir"
    fi
    $ECHO make -C $dir $cmd >> install.log 2>&1
    if [ $? -ne 0 ] 
    then 
      return 1
    fi
  done
  return 0
}

###########################################################################
InstallerSync()
###########################################################################
{
 (
  mkdir -p $ALIEN_INSTALLER_HOME || Error "Error: Cannot create $ALIEN_INSTALLER_HOME directory"
  cd $ALIEN_INSTALLER_HOME
  $wget makefiles.tar.bz2 ${ALIEN_BITS_URL}../makefiles.tar.bz2 > /dev/null 2>&1 || Error "Error: Cannot fetch makefiles from ${ALIEN_BITS_URL}../makefiles.tar.bz2. Please check outgoing network connectivity."
  tar jxf makefiles.tar.bz2 && rm makefiles.tar.bz2 
  which wget > /dev/null 2>&1 
  if [ $? -eq 0 ]
  then
     cat<<'EOF'>wget.sh
#/bin/sh
wget $*
EOF
   chmod +x wget.sh
   fi
  ) >> install.log 2>&1
}

###########################################################################
InstallerSetup()
###########################################################################
{
  style="--title AliEn-Installer-v$VERSION --clear"
  dialog_file=`mktemp /tmp/dialog.XXXXXX`

  if [ -f $ALIEN_INSTALLER_PREFIX/bin/dialog ]
  then
     export LD_LIBRARY_PATH=$ALIEN_INSTALLER_PREFIX/lib:$LD_LIBRARY_PATH
     dialog_form=$ALIEN_INSTALLER_PREFIX/bin/dialog
     export TERMINFO_DIRS=/usr/share/terminfo:$ALIEN_INSTALLER_PREFIX/share/terminfo
  else
     dialog_form=dialog
  fi

  $ALIEN_DIALOG $style \
                  --radiolist 'PLEASE SELECT SCOPE FOR THIS CONFIGURATION' 0 0 0 \
                              'common'               'Common for all users' on \
                              'user'                 'Individual user configuration' 0  2>$dialog_file || Exit 1 
  config_scope=`cat $dialog_file`

  eval `InstallerConfig`

  VARS="GLOBUS_LOCATION GAPI_LOCATION MYPROXY_LOCATION"

  i=1
  form=""
  for var in $VARS
  do
    if [ "${!var}" != "" ]
    then
      form="$form $var  $i 1 ${!var}  $i 25 256 0"
      i=`expr $i + 1`
    else
      eval $var="Unknown"
    fi
  done

  style="--title AliEn-Installer-v$VERSION --clear --stdout"

  $dialog_form $style --form 'This is your curent AliEn environment. Please edit.' 20 50 0  $form > $dialog_file 2>&1

  arg1=`cat $dialog_file | \
( 
  read GLOBUS_LOCATION 
  read GAPI_LOCATION 
  read MYPROXY_LOCATION

  [ "$GLOBUS_LOCATION" != "" ] && \
                         arg=$arg" --globus-location $GLOBUS_LOCATION"
  [ "$GAPI_LOCATION" != "" ] && \
                         arg=$arg" --gapi-location $GAPI_LOCATION"
  [ "$MYPROXY_LOCATION" != "" ] && \
                         arg=$arg" --myproxy-location $MYPROXY_LOCATION"

  echo $arg 
)`

  ALIEN_ORGANISATION=${ALIEN_ORGANISATION:=Alice}
  ALIEN_USER=${ALIEN_USER:=${USER}}
  ALIEN_PROMPT=${ALIEN_PROMPT:=alien}
  ALIEN_LDAP_DN=${ALIEN_LDAP_DN:=auto}
  ALIEN_MYPROXY_SERVER=${ALIEN_MYPROXY_SERVER:=none}
  ALIEN_MYPROXY_DOMAIN=${ALIEN_MYPROXY_DOMAIN:=none}

  VARS="ALIEN_ORGANISATION ALIEN_USER ALIEN_PROMPT ALIEN_LDAP_DN ALIEN_MYPROXY_SERVER ALIEN_MYPROXY_DOMAIN"

  i=1
  form=""
  for var in $VARS
  do
    if [ "${!var}" != "" ]
    then
      form="$form $var  $i  1 ${!var}   $i 25 25 0"
    else
      form="$form $var  $i  1 \"\"  $i 25 25 0"
    fi
    i=`expr $i + 1`
  done

  $dialog_form $style --form 'This is your curent AliEn configuration. Please edit.' 20 50 0  $form > $dialog_file 2>&1

  arg2=`cat $dialog_file | \
( 
  read ALIEN_ORGANISATION 
  read ALIEN_USER 
  read ALIEN_PROMPT 
  read ALIEN_LDAP_DN 
  read ALIEN_MYPROXY_SERVER 
  read ALIEN_MYPROXY_DOMAIN

  [ "$ALIEN_USER" != "" ] && \
                         arg=$arg" --user $ALIEN_USER"
  [ "$ALIEN_ORGANISATION" != "" ] && \
                         arg=$arg" --VO $ALIEN_ORGANISATION"
  [ "$ALIEN_PROMPT" != "" ] && \
                         arg=$arg" --prompt $ALIEN_PROMPT"
  [ "$ALIEN_LDAP_DN" != "" -a "$ALIEN_LDAP_DN" != "auto" ] && \
                         arg=$arg" --ldap-dn $ALIEN_LDAP_DN"
  [ "$ALIEN_MYPROXY_SERVER" != "" -a "$ALIEN_MYPROXY_SERVER" != "none" ] && \
                         arg=$arg" --myproxy-server $ALIEN_MYPROXY_SERVER"
  [ "$ALIEN_MYPROXY_DOMAIN" != "" -a "$ALIEN_MYPROXY_DOMAIN" != "none" ] && \
                         arg=$arg" --myproxy-domain $ALIEN_MYPROXY_DOMAIN"

  echo $arg
)` 


  case $config_scope in
        common)
            outfile=$ALIEN_ROOT/.Environment
           ;;
        *)
            outfile=$HOME/.alien/Environment
           ;;
  esac

  if [ -f $outfile ]
  then
    cp $outfile $outfile.old
  fi

  InstallerConfig $arg1 $arg2 > $outfile

  if [ $? -eq 1 ]
  then
    $ALIEN_DIALOG $style \
          --msgbox 'Configuration failed: Please check the log file.' $height $width
    $ALIEN_DIALOG $style \
          --textbox install.log 0 0  
    Exit 1
  else
    $ALIEN_DIALOG $style \
              --msgbox 'You have sucessfuly installed and configured  AliEn gridware on your computer. Enjoy!' $height $width  
 
    Exit 0
  fi

  Exit 0
}

###########################################################################
InstallerCount()
###########################################################################
{
  grep -e NONE
}

###########################################################################
InstallerUpdate()
###########################################################################
{
  InstallerSync

  InstallerRcUpdate

  export TPUT=undef

  workspace=$ALIEN_INSTALLER_HOME

  cd $ALIEN_INSTALLER_HOME

  if [ -f $ALIEN_INSTALLER_PREFIX/bin/alien-perl ] 
  then
     if [ -f $ALIEN_INSTALLER_PREFIX/.Environment ] 
     then
       cp $ALIEN_INSTALLER_PREFIX/.Environment /tmp/.Environment.$$
     fi 
     rm -rf $ALIEN_INSTALLER_PREFIX/* 
     if [ -f /tmp/.Environment.$$ ] 
     then
       cp /tmp/.Environment.$$ $ALIEN_INSTALLER_PREFIX/.Environment 
     fi 
  fi 
  rm -rf apps/*/*/cookies/*binextract* apps/*/*/cookies/*relocate*

  [ ! -f  $ALIEN_INSTALLER_HOME/configure ] && Error "Error: Cannot find  $ALIEN_INSTALLER_HOME/configure file."

 (cd $ALIEN_INSTALLER_HOME; ./configure --with-alien-release=$ALIEN_RELEASE  --with-platform=$ALIEN_INSTALLER_PLATFORM --with-bits-url=$ALIEN_BITS_URL --prefix=$ALIEN_INSTALLER_PREFIX >> install.log 2>&1 ) 

  export GARAUTODETECT=$ALIEN_INSTALLER_AUTODETECT

  err=0

  packages=""

  rm -rf packages.list

  list=`echo $ALIEN_INSTALLER_TYPE | sed 's/"//g'`

  npkgs=`echo $list | wc -w`;  i=0

  for meta in $list
  do
      pkgdir=`echo $meta | sed 's/"//g'`
      if [ "$pkgdir" = "" ] 
      then
           continue
      fi
      if [ -d $ALIEN_INSTALLER_HOME/meta/$pkgdir ]
      then
            if [ -f $ALIEN_INSTALLER_HOME/meta/$pkgdir/.metadeps ] 
            then
               plist=`cat $ALIEN_INSTALLER_HOME/meta/$pkgdir/.metadeps`
            else 
               plist=`cd $ALIEN_INSTALLER_HOME/meta/$pkgdir; make show-unique-deps`
            fi
            for pkg in $plist;
            do
                echo $pkg >>packages.list;
            done;
        fi;
  done
  if [ -s packages.list ] 
  then
        packages=`cat packages.list | sort -u`;
  fi;
  for target in bininstall relocate;
  do
        for pkg in $packages;
        do
            if [ $target = "bininstall" ]; then
                msg="Installing";
            else
                msg="Relocating";
            fi;
            echo "$msg $pkg...";
            if [ ! -d $pkg ]; then
                echo "No such package: $dir";
                exit 1;
            fi;
            make -s -C $pkg $target LIBDEPS= BUILDDEPS= >package.log 2>&1 || echo "Failed";
            cat package.log >>$ALIEN_INSTALLER_HOME/install.log;
        done
  done;

  if [ -f $ALIEN_INSTALLER_HOME/ALIEN_VERSION ]
  then
    cp -f $ALIEN_INSTALLER_HOME/ALIEN_VERSION $ALIEN_INSTALLER_PREFIX/share/alien 
  fi

  rm -rf $release_file $dialog_file

  sc=`SanityCheck`

  if [ $sc != 0 ]
  then
    echo "Errors were reported during installation. Please check $workspace/install.log"
    exit 1
  else
    echo "You have sucessfuly installed  AliEn gridware on your computer."
  fi

  exit 0

}


###########################################################################
InstallerUI()
###########################################################################
{
  cmd="./configure "

  export TPUT=undef

  style="--title AliEn-Installer-v$VERSION --clear"

  dialog_file=`mktemp /tmp/dialog.XXXXXX`

  url=http://alien.cern.ch/Releases
  release_file=`mktemp /tmp/release.XXXXXX`
    
  $wget $release_file $url > /dev/null 2>&1 || Error "Error: Cannot fetch Releases file from $url. Please check outgoing network connectivity." 
   
  url=http://alien.cern.ch/BitServers
  cache_file=`mktemp /tmp/cache.XXXXXX`

  $wget $cache_file $url > /dev/null 2>&1 || Error "Error: Cannot fetch BitServers file from $url. Please check outgoing network connectivity."  

  list=`grep -v -e HEAD -e "^#" $release_file |  awk -F: '{if (i==0 && index($4,"Stable")) {on="on"; i=1 } else {on="0"}; printf("%s %s %s ",$3,$4,on);}'`

  $ALIEN_DIALOG $style \
            --radiolist 'PLEASE SELECT ALIEN RELEASE:' 0 0 0 \
                        'HEAD' 'Curent CVS HEAD (Warning: use at own risk!)' 0 \
                        $list 2>$dialog_file

  case $? in
    127)
       Exit 1 "ERROR: Dialog could not be invoked. Is dialog installed?"
       ;;
    1)
       Exit 1
       ;;
    *) 
       ;;
  esac

  release=`cat $dialog_file`

  ALIEN_RELEASE=$release

  cmd=$cmd" --with-alien-release=$ALIEN_RELEASE "

  ALIEN_INSTALLER_AUTODETECT="false"

  workspace=$ALIEN_INSTALLER_HOME

  $ALIEN_DIALOG  $style \
          --yesno "Default workspace location for this installation is\n\n$workspace\n\nPress YES if you want to keep it that way or press NO if you want to pick another location."  0 0 

  if [ $? -eq 1 ]
  then
     $ALIEN_DIALOG $style \
                    --inputbox $workspace/ $height $width \
                     2>$dialog_file || Exit 1
     workspace=`cat $dialog_file`
  fi

  mkdir -p $workspace || Error "Cannot create $workspace directory."

  ALIEN_INSTALLER_HOME=$workspace

  cd $workspace || ( Error  "Cannot change directory to $workspace" )

  cmd=$cmd" --with-cache-dir=$workspace "

  platform=$ALIEN_INSTALLER_PLATFORM

  if [ `grep -v -e "^#" $cache_file | grep -c $platform` -eq 0 ]
  then
    platform="Unknown"
  fi

  $ALIEN_DIALOG  $style \
            --yesno "Detected/configured platform setting for this machine is:\n\n$platform\n\nPress YES if you want to keep it that way or press NO if you want to select another supported platform." 0 0 

  if [ $? -eq 1 ] 
  then 
       $ALIEN_DIALOG $style \
                  --radiolist 'PLEASE SELECT PLATFORM:' 0 0 0 \
                              'i686-pc-linux-gnu'         'Linux i686' on \
                              'ia64-unknown-linux-gnu'    'Linux ia64' 0  \
                              'x86_64-unknown-linux-gnu'  'Linux Opteron' 0  \
                              'i686-apple-darwin8.6.1'    'MacOS X (Intel)' 0 \
                              'x86_64-apple-darwin8.6.1'  'MacOS X (Intel 64 bit)' 0 \
      2>$dialog_file
      platform=`cat $dialog_file`
  fi

  cmd=$cmd"--with-platform=$platform "

  ALIEN_INSTALLER_PLATFORM=$platform  

  if [ "$ALIEN_INSTALLER_TEST" = "" ]
  then 
    [ `awk -F: '{print $3, $5}'  $release_file | grep -c -e "^.*$ALIEN_RELEASE.*$ALIEN_INSTALLER_PLATFORM"` -eq 0 ] && Error  "Sorry, release $ALIEN_RELEASE is not (yet) supported on $ALIEN_INSTALLER_PLATFORM platform."
  fi

  caches=`grep -v -e "^#" $cache_file | grep $platform | awk -v platform=$ALIEN_INSTALLER_PLATFORM -v release=$ALIEN_RELEASE -F'|' '{printf("%s/%s/%s/download/",$2,platform,release)}' | sed 's/ *//'`
  cmd=$cmd" --with-bits-url=$caches "

  ALIEN_BITS_URL=$caches

  InstallerSync

  prefix=$ALIEN_INSTALLER_PREFIX

  if [ "$prefix" = "$workspace" ]
  then
    prefix="unknown"
  fi

  $ALIEN_DIALOG $style \
         --yesno "Default installation location location is\n\n$prefix\n\nPress YES if you want to keep it that way or press NO if you want to select another location." 0  0

  if [ $? -eq 1 ]
  then
    while :
    do
     $ALIEN_DIALOG $style \
                    --inputbox $HOME/ $height $width \
                     2>$dialog_file || Exit 1

     prefix=`cat $dialog_file`
     if [ "$prefix" = "$workspace" ]
     then
       $ALIEN_DIALOG $style --sleep 3 \
              --infobox "Installation prefix ($prefix) must be different from workspace ($workspace)." $height $width
     else
       break
     fi
    done
  fi

  if [ -d $prefix ]
  then
    $ALIEN_DIALOG  $style \
            --yesno "Directory $prefix already exist. Press YES if you want to overwrite existing files, press NO if you want cancel the installation." 0 0 || Exit 1
  fi 

  ALIEN_INSTALLER_PREFIX=$prefix

  mkdir -p $prefix || Error "Cannot create $prefix directory"

  if [ -f $ALIEN_INSTALLER_PREFIX/bin/alien-perl ] 
  then
     if [ -f $ALIEN_INSTALLER_PREFIX/.Environment ] 
     then
       cp $ALIEN_INSTALLER_PREFIX/.Environment /tmp/.Environment.$$
     fi 
     rm -rf $ALIEN_INSTALLER_PREFIX/* 
     if [ -f /tmp/.Environment.$$ ] 
     then
       cp /tmp/.Environment.$$ $ALIEN_INSTALLER_PREFIX/.Environment 
     fi 
  fi 

  cmd=$cmd"--prefix=$prefix"

  $ALIEN_DIALOG $style \
               --checklist 'PLEASE SELECT THE INSTALLATION TYPE' 0 0 0  \
                           'all'     'All packages'             0  \
                           'client'  'Simple Client UI'         0  \
                           'gshell'  'Grid Shell UI'            0  \
                           'xrootd'  'xrootd for AliEn'         0  \
                           'portal'  'Portal'                   0  \
                           'bank'    'Bank'                     0  \
                           'site'    'Site CE/SE services'      0  \
                           'lcg'     'LCG Components'           0  \
                           'monitor' 'MonaLisa site monitor'    0  \
                           'core'    'Core VO services'         0  \
                           'wn'      'Worker node'              0  \
                           'arc'     'ARC Interface'            0  \
                           'tests'   'AliEn tests'              0 2>$dialog_file || Exit 1

  list=\"$(cat $dialog_file | sed 's/"//g' )\"

  if [ "$list" = "" ]
  then
    Error "Nothing selected - exiting..."
  fi

  ALIEN_INSTALLER_TYPE="$list"
  
  echo $cmd > install.log

  $ALIEN_DIALOG $style --sleep 3 \
              --infobox 'Configuring...' $height $width
 
  InstallerRcUpdate

  $cmd >> install.log 2>&1 || Error "Error: configure commad failed ($cmd)."

  (cd $workspace; rm -rf apps/*/*/cookies/*binextract* apps/*/*/cookies/*relocate*)

  export GARAUTODETECT="$ALIEN_INSTALLER_AUTODETECT"

  packages=""

  rm -rf packages.list

  list=`echo $list | sed 's/"//g'`

  npkgs=`echo $list | wc -w`;  i=0

  for meta in $list
  do
      i=$[i + 1]
      g=$[$[i * 100]/$[npkgs]]
      pkgdir=`echo $meta | sed 's/"//g'`
      if [ "$pkgdir" = "" ] 
      then
           continue
      fi
      echo XXX
      echo "Evaluating dependencies for $meta. Please wait...."
      echo XXX
      if [ -d $ALIEN_INSTALLER_HOME/meta/$pkgdir ]
      then
            if [ -f $ALIEN_INSTALLER_HOME/meta/$pkgdir/.metadeps ] 
            then
               plist=`cat $ALIEN_INSTALLER_HOME/meta/$pkgdir/.metadeps`
            else 
               plist=`cd $ALIEN_INSTALLER_HOME/meta/$pkgdir; make show-unique-deps`
            fi
            for pkg in $plist;
            do
                echo $pkg >>packages.list;
            done;
        fi;
        echo $g;
  done | $ALIEN_DIALOG $style --gauge "Checking dependencies" $height $width;
  if [ -s packages.list ] 
  then
        packages=`cat packages.list | sort -u`;
  fi;
  npkgs=`echo $packages | wc -w`;
  for target in bininstall relocate;
  do
        i=0;
        for pkg in $packages;
        do
            if [ $target = "bininstall" ]; then
                msg="Installing";
            else
                msg="Relocating";
            fi;
            i=$[i + 1];
            p=$[$[i * 100]/$[npkgs]];
            echo XXX;
            echo "$msg $pkg...";
            if [ ! -d $pkg ]; then
                echo "No such package: $dir";
                exit 1;
            fi;
            make -s -C $pkg $target LIBDEPS= BUILDDEPS= >package.log 2>&1
            if [ $? -ne 0 ]
            then 
               cat package.log >>$ALIEN_INSTALLER_HOME/install.log
               break
            fi 
            echo XXX;
            echo $p;
        done | $ALIEN_DIALOG $style --gauge "Processing $pkg..." $height $width;
  done;

  if [ -f $ALIEN_INSTALLER_HOME/ALIEN_VERSION ]
  then
    cp -f $ALIEN_INSTALLER_HOME/ALIEN_VERSION $ALIEN_INSTALLER_PREFIX/share/alien 
  fi

  rm -rf $release_file $dialog_file

  sc=`SanityCheck`

  if [ $sc != 0 ]
  then
    $ALIEN_DIALOG $style \
          --msgbox "Errors were reported during installation. Please check $workspace/install.log"  $height $width
    $ALIEN_DIALOG $style \
                     --textbox $workspace/install.log 40 60
    Exit 1 
  else
    if [ -x  $ALIEN_INSTALLER_PREFIX/bin/alien ]
    then
      $ALIEN_DIALOG $style --sleep 3 \
              --infobox 'Running post installation scripts...' $height $width
      $ALIEN_INSTALLER_PREFIX/bin/alien setup common >> install.log
    fi
    $ALIEN_DIALOG $style \
          --msgbox 'You have sucessfuly installed  AliEn gridware on your computer.' $height $width
  fi

  Exit 0
}


###########################################################################
SanityCheck()
###########################################################################
{
   rc=`grep -c -e "GAR GAR GAR" -e "No such file or directory" $workspace/install.log`
   echo $rc
}

###########################################################################
FindLocation()
###########################################################################
{
  STANDARD_DIRS="$ALIEN_ROOT $ALIEN_ROOT/globus /opt/globus /usr/local /usr/bin /usr/lib /opt/glite /opt/glite/externals"
  if [ "$2" != "" ]
  then
     echo $2
  else
     for dir in $STANDARD_DIRS
     do
       if [ -d $dir ]
       then
         if test "`uname -s`" = "Darwin" ; then
           file=`find -L $dir -path $1 -type f -print -maxdepth 3 2>/dev/null`
         else
           file=`find $dir -path $1 -xtype f -print -maxdepth 3 2>/dev/null`
         fi
         if [ -f "$file" ]
         then
           bindir=`dirname $file`
           dirname $bindir
           break
         fi
       fi
     done
  fi
}
###########################################################################
InstallerConfig()
###########################################################################
{
  if [ "$ALIEN_INSTALLER_PLATFORM" = "x86_64-unknown-linux-gnu" -o "$ALIEN_INSTALLER_PLATFORM" = "ia64-unknown-linux-gnu" ] ; then
    BIT64_LIBS=":$ALIEN_ROOT/lib64"
  fi
  ALIEN_ROOT=$ALIEN_INSTALLER_PREFIX
  ALIEN_PATH=""
  ALIEN_LD_LIBRARY_PATH="$ALIEN_ROOT/lib$BIT64_LIBS"
  ALIEN_MYPROXY_SERVER=""
  ALIEN_MYPROXY_DOMAIN=""
  ALIEN_LDAP_DN=""
  GLOBUS_LOCATION=""

  MYPROXY_LOCATION="$ALIEN_INSTALLER_PREFIX"
  GAPI_LOCATION="$ALIEN_INSTALLER_PREFIX/api"

  ALIEN_VO=""
  ALIEN_PROMPT=""
  ALIEN_ORGANISATION=""
  ALIEN_USER=""

  if test "`uname -s`" = "Darwin" ; then DY_EXT=dylib ; else DY_EXT=so ; fi

  while [ $# -gt 0 ]
  do
    case $1 in
        --gapi-location|-gapi-location)
            shift 1
            GAPI_LOCATION=$1; shift 1
           ;;
        --globus-location|-globus-location)
            shift 1
            GLOBUS_LOCATION=$1; shift 1
           ;;
        --myproxy-location|-myproxy-location)
            shift 1
            MYPROXY_LOCATION=$1; shift 1
            ;;
        --myproxy-server|-myproxy-server)
            shift 1
            ALIEN_MYPROXY_SERVER=$1; shift 1
            ;;
        --myproxy-domain|-myproxy-domain)
            shift 1
            ALIEN_MYPROXY_DOMAIN=$1; shift 1
            ;;
        --ldap-dn|-ldap-dn)
            shift 1
            ALIEN_LDAP_DN=$1; shift 1
            ;;
        --VO|-VO)
            shift 1
            ALIEN_DEFAULT_VO=$1; shift 1
            ;;
        --user|-user)
            shift 1
            ALIEN_DEFAULT_USER=$1; shift 1
            ;;
        --prompt|-prompt)
            shift 1
            ALIEN_DEFAULT_PROMPT=$1; shift 1
            ;;

        --help|-help)
            printf "Usage: %5s configure                       \n" $ALIEN_PROMPT
            printf "             --gapi-location       [path]  \n"
            printf "             --globus-location     [path]  \n"
            printf "             --myproxy-location    [path]  \n"
            printf "             --myproxy-server      [host]  \n"
            printf "             --myproxy-domain      [dn]    \n"
            printf "             --ldap-dn             [url]   \n"
            printf "             --VO                  [string]\n"
            printf "             --user                [string]\n"
            printf "             --prompt              [string]\n"
            exit
           ;;
        *)
           shift 1
           ;;
    esac
  done


  #########
  # gapi
  #########
  GAPI_LOCATION=`FindLocation "*/bin/gbbox" $GAPI_LOCATION`

  if [ -f $GAPI_LOCATION/bin/gbbox ]
  then
    ALIEN_PATH=$GAPI_LOCATION/bin:$ALIEN_PATH
    ALIEN_LD_LIBRARY_PATH=$GAPI_LOCATION/lib:$ALIEN_LD_LIBRARY_PATH
  else
     GAPI_LOCATION=''
  fi

  #########
  # globus
  #########
  set -f
  GLOBUS_LOCATION=`FindLocation "*/bin/grid-proxy-init" $GLOBUS_LOCATION`

  if [ -f $GLOBUS_LOCATION/bin/grid-proxy-init ]
  then
    ALIEN_PATH=$GLOBUS_LOCATION/bin:$ALIEN_PATH
    ALIEN_LD_LIBRARY_PATH=$GLOBUS_LOCATION/lib:$ALIEN_LD_LIBRARY_PATH
  else
     GLOBUS_LOCATION=''
  fi

  #########
  # SWIG
  #########

  SWIG_LOCATION=`FindLocation "*/bin/swig" $SWIG_LOCATION`

  if [ -f $SWIG_LOCATION/bin/swig ]
  then
    ALIEN_LD_LIBRARY_PATH=$SWIG_LOCATION/lib:$ALIEN_LD_LIBRARY_PATH
  else
     SWIG_LOCATION=''
  fi

  #########
  # myproxy
  #########

  MYPROXY_LOCATION=`FindLocation "*/bin/myproxy-init" $MYPROXY_LOCATION`

  if [ -x $MYPROXY_LOCATION/bin/myproxy-init ]
  then
    ALIEN_PATH=$MYPROXY_LOCATION/bin:$ALIEN_PATH
    ALIEN_LD_LIBRARY_PATH=$MYPROXY_LOCATION/lib:$ALIEN_LD_LIBRARY_PATH
  else
     MYPROXY_LOCATION=''
  fi

  ALIEN_PATH=`echo $ALIEN_PATH |awk  '{gsub(":", "\n" ); print $0 '} |sort -u |awk '{printf "%s:",$1}' | sed 's/:$//'`
  ALIEN_LD_LIBRARY_PATH=`echo $ALIEN_LD_LIBRARY_PATH |awk  '{gsub(":", "\n" ); print $0 '} |sort -u | awk '{printf "%s:",$1}' | sed 's/:$//'`

  echo "ALIEN_PATH=$ALIEN_PATH"
  echo "ALIEN_LD_LIBRARY_PATH=$ALIEN_LD_LIBRARY_PATH"

  if [ ! -z "$GAPI_LOCATION" ]; then
      echo "GAPI_LOCATION=$GAPI_LOCATION"
  fi
  if [ ! -z "$ALIEN_MYPROXY_SERVER" ]; then
      echo "ALIEN_MYPROXY_SERVER=$ALIEN_MYPROXY_SERVER"
  fi
  if [ ! -z "$ALIEN_MYPROXY_DOMAIN" ]; then
      echo "ALIEN_MYPROXY_DOMAIN=$ALIEN_MYPROXY_DOMAIN"
  fi
  if [ ! -z "$ALIEN_LDAP_DN" ]; then
      echo "ALIEN_LDAP_DN=$ALIEN_LDAP_DN"
  fi
  if [ ! -z "$GLOBUS_LOCATION" ]; then
      echo "GLOBUS_LOCATION=$GLOBUS_LOCATION"
  fi
  if [ ! -z "$MYPROXY_LOCATION" ]; then
      echo "MYPROXY_LOCATION=$MYPROXY_LOCATION"
  fi
  if [ ! -z "$ALIEN_PROMPT" ]; then
      echo "ALIEN_PROMPT=$ALIEN_DEFAULT_PROMPT"
  fi
  if [ ! -z "$ALIEN_DEFAULT_VO" ]; then
      echo "ALIEN_ORGANISATION=$ALIEN_DEFAULT_VO"
  fi
  if [ ! -z "$ALIEN_DEFAULT_USER" ]; then
      echo "ALIEN_USER=$ALIEN_DEFAULT_USER"
  fi
}

###########################################################################
###########################################################################

debug=0

args=$*
 
while [ $# -gt 0 ]
do
    case $1 in
        selfupdate|sync)
            InstallerSync 
            name=`echo $0 | sed 's%./%%'`
            exec $ALIEN_INSTALLER_HOME/alien-installer --copy $0
           ;;
        --copy)
            shift 1
            cp -f $0 $1
	    exit
           ;;
        -r|--release)
            shift 1
	    ALIEN_RELEASE=$1
            ALIEN_BITS_URL="http://alienbuild.cern.ch:8888/$ALIEN_INSTALLER_PLATFORM/$ALIEN_RELEASE/download/" 
            shift 1
           ;;
        -t|--type)
            shift 1
	    ALIEN_INSTALLER_TYPE=$1
            shift 1
           ;;
        --platform)
            shift 1
	    ALIEN_INSTALLER_PLATFORM=$1
            shift 1
           ;;
        --prefix)
            shift 1
	    ALIEN_INSTALLER_PREFIX=$1
            shift 1
           ;;
        -a|--autodetect)
            shift 1
	    ALIEN_INSTALLER_AUTODETECT=1
           ;;
        -f|--force)
            shift 1
	    ALIEN_FORCE=1
           ;;
        --runtime)
            shift 1
	    export INSTALL_FILTER="doc/% %.a %.la info/% share/doc/%" 
           ;;
        --pretend)
            shift 1
	    ECHO=echo
           ;;
        -p|--build-prefix|--home)
            shift 1
	    ALIEN_INSTALLER_HOME=$1
            shift 1
            mkdir -p $ALIEN_INSTALLER_HOME || exit 1
           ;;
        update|update-all)
            shift 1
	    InstallerUpdate $*
            exit
           ;;
        make)
            shift 1
            InstallerMake $*
            exit
           ;;
        test)
            shift 1
            InstallerMake test $*
            exit
           ;;
        makepkg)
            shift 1
            InstallerMakePkg $*
            exit
           ;;
        remove)
            shift 1
            InstallerMake buildclean $*
            exit
           ;;
        purge)
            shift 1
            InstallerMake clean $*
            exit
           ;;
        install)
           shift 1
           InstallerMake bininstall $*
           exit
           ;;
        configure)
            shift 1
            cd $ALIEN_INSTALLER_HOME && ./configure $*
            exit
           ;;
        setup)
            shift 1
            InstallerSetup $*
            exit
           ;;
        -q)
           shift 1
	   QUIET=1
           ;;
        -v|--trace)
           shift 1
           debug=1
           set -vx
           ;;
        -V)
           print $VERSION
           exit
           ;; 
        -y)
           shift 1
           YES=1
           ;;
        --help|-help|-h)
            cat<<EOF

Usage: alien-installer <installer options> [[configure <configure options>]|[update]]
 
Installer options:
  -p, --build-prefix - installation directory
  -h, --help         - display this help text
  -q, --quiet        -  be less verbose, opposite of --verbose
  -V, --version      - display version information
  -v, --verbose      - to be more verbose, opposite of --quiet
 
  --prefix <path>            [/opt/alien]  
  --home <path>              [$HOME/alien]
  --release <RELEASE>        [HEAD] 
  --type <installation type> [all,client,portal,site,core,wn]
  --platform <platform>      [,i686-pc-linux-gnu,ia64-unknown-linux-gnu,powerpc-apple-darwin7.7.0]
  
Configure options:
  --prefix=dir                   Installation prefix 
  --with-globus-location=dir     Globus directory
  --with-gpt-location=dir        GPT directory
  --with-globus-flavor=string    Globus flavor
  --with-glite-build=string      gLite build id
  --with-cache-dir=dir           Local package cache
  --with-cache-url=url           Remote package cache
  --with-platform=string         Platform
EOF


            exit
           ;;
        *)
           shift 1
           ;;
    esac
done

InstallerUI $*

